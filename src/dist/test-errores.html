<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prueba de Errores de Conexi√≥n</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .container {
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0.1);
        }
        .btn {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
        }
        .btn-primary { background: #3b82f6; color: white; }
        .btn-danger { background: #ef4444; color: }
        .btn-warning { background: #f59e0b; color: white; }
        .btn-success { background: #10b981; color: white; }
        .btn:hover { transform: translateY(-1px); }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-weight: 500;
        }
        .online { background: #d1fae5; color: #065f46; }
        .offline { background: #fee2e2; color: #991b1e; }
        .error { background: #fee2e2; color: #991b1e; }
        .success { background: #d1fae5; color: #065f46; }
        .warning { background: #fef3c7; color: #92400e; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Prueba de Errores de Conexi√≥n</h1>
        <p class="text-gray-600">Esta p√°gina simula diferentes tipos de errores de conexi√≥n para probar el sistema de manejo de errores del frontend.</p>
        
        <div class="status online">
            üü¢ Estado: Conectado a internet
        </div>
        
        <h2>Pruebas de Errores</h2>
        
        <div class="grid grid-cols-2 gap-4">
            <button class="btn btn-primary" onclick="testFetchSuccess()">
                ‚úÖ Fetch Exitoso
            </button>
            <button class="btn btn-danger" onclick="testFetchError()">
                ‚ùå Fetch Error 404
            </button>
            <button class="btn btn-warning" onclick="testFetchServerError()">
                ‚ö†Ô∏è Fetch Error 500
            </button>
            <button class="btn btn-danger" onclick="testNetworkError()">
                üîå Error de Red
            </button>
            <button class="btn btn-warning" onclick="testTimeoutError()">
                ‚è±Ô∏è Timeout Error
            </button>
        </div>
        
        <div id="resultado" class="status">
            <div id="resultado-contenido">
                <p>Espera una prueba...</p>
            </div>
        </div>
        
        <h2>Pruebas de Conexi√≥n</h2>
        <button class="btn btn-warning" onclick="testOffline()">
            üîå Simular Desconexi√≥n
        </button>
        <button class="btn btn-success" onclick="testOnline()">
            üü¢ Restaurar Conexi√≥n
        </button>
        
        <div id="resultado-conexion" class="status">
            <div id="resultado-conexion-contenido">
                <p>Conexi√≥n estable</p>
            </div>
        </div>
        
        <h2>Logs de Errores</h2>
        <div id="logs" class="bg-gray-100 p-4 rounded-lg text-xs font-mono">
            <div id="logs-contenido">
                <p>Los errores aparecer√°n aqu√≠...</p>
            </div>
        </div>
    </div>

    <script>
        let errorCount = 0;
        
        function log(message, type = 'info') {
            const logsDiv = document.getElementById('logs-contenido');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `<span class="text-gray-500">[${timestamp}]</span> <span class="${type === 'error' ? 'text-red-600' : type === 'warning' ? 'text-yellow-600' : 'text-green-600'}">[${type.toUpperCase()}]</span> ${message}`;
            logsDiv.appendChild(logEntry);
            logsDiv.scrollTop = logsDiv.scrollHeight;
            errorCount++;
        }
        
        function updateResultado(mensaje, type = 'info') {
            const resultadoDiv = document.getElementById('resultado-contenido');
            resultadoDiv.innerHTML = `<p class="${type === 'error' ? 'text-red-600' : type === 'warning' ? 'text-yellow-600' : 'text-green-600'}">${mensaje}</p>`;
            const resultado = document.getElementById('resultado');
            resultado.className = `status ${type}`;
        }
        
        function updateResultadoConexion(mensaje, type = 'info') {
            const resultadoDiv = document.getElementById('resultado-conexion-contenido');
            resultadoDiv.innerHTML = `<p class="${type === 'error' ? 'text-red-600' : type === 'warning' ? 'text-yellow-600' : 'text-green-600'}">${mensaje}</p>`;
            const resultado = document.getElementById('resultado-conexion');
            resultado.className = `status ${type}`;
        }
        
        function testFetchSuccess() {
            log('Iniciando prueba de fetch exitoso', 'info');
            updateResultado('Conexi√≥n exitosa', 'success');
            
            fetch('http://localhost:3000/api/productos')
                .then(response => response.json())
                .then(data => {
                    log(`‚úÖ Fetch exitoso: ${data.length} productos cargados`, 'success');
                    updateResultado(`‚úÖ Conexi√≥n exitosa: ${data.length} productos cargados`, 'success');
                })
                .catch(error => {
                    log(`‚ùå Error inesperado: ${error.message}`, 'error');
                    updateResultado(`‚ùå Error inesperado: ${error.message}`, 'error');
                });
        }
        
        function testFetchError() {
            log('Iniciando prueba de fetch error 404', 'warning');
            updateResultado('Probando error 404...', 'warning');
            
            fetch('http://localhost:3000/api/no-existe')
                .then(response => {
                    log(`‚ùå Respuesta inesperada: ${response.status}`, 'error');
                    updateResultado(`‚ùå Error 404: Recurso no encontrado`, 'error');
                })
                .catch(error => {
                    log(`‚úÖ Error capturado: ${error.message}`, 'success');
                    updateResultado(`‚úÖ Error 404: Recurso no encontrado`, 'error');
                });
        }
        
        function testFetchServerError() {
            log('Iniciando prueba de fetch error 500', 'warning');
            updateResultado('Probando error 500...', 'warning');
            
            fetch('http://localhost:3000/api/error-simulado')
                .then(response => {
                    log(`‚ùå Error del servidor: ${response.status}`, 'error');
                    updateResultado(`‚ùå Error 500: Error interno del servidor`, 'error');
                })
                .catch(error => {
                    log(`‚úÖ Error capturado: ${error.message}`, 'success');
                    updateResultado(`‚úÖ Error 500: Error interno del servidor`, 'error');
                });
        }
        
        function testNetworkError() {
            log('Iniciando prueba de error de red', 'error');
            updateResultado('Probando error de red...', 'error');
            
            fetch('http://192.168.100.224:9999/api/productos')
                .then(response => {
                    log(`‚ùå Error de red: ${response.status}`, 'error');
                    updateResultado(`‚ùå Error de red: Servidor no disponible`, 'error');
                })
                .catch(error => {
                    log(`‚úÖ Error de red capturado: ${error.message}`, 'success');
                    updateResultado(`‚úÖ Error de red: ${error.message}`, 'error');
                });
        }
        
        function testTimeoutError() {
            log('Iniciando prueba de timeout', 'warning');
            updateResultado('Probando timeout...', 'warning');
            
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), 100);
            
            fetch('http://localhost:3000/api/productos', { signal: controller.signal })
                .then(response => {
                    log(`‚ùå Timeout no deber√≠a llegar aqu√≠`, 'error');
                    updateResultado(`‚ùå Error de timeout: La petici√≥n tard√≥ demasiado`, 'error');
                })
                .catch(error => {
                    log(`‚úÖ Timeout capturado: ${error.name}: ${error.message}`, 'success');
                    updateResultado(`‚úÖ Timeout capturado: ${error.name}: ${error.message}`, 'success');
                });
        }
        
        function testOffline() {
            log('Simulando desconexi√≥n...', 'warning');
            updateResultado('üîå Simulando desconexi√≥n...', 'warning');
            
            // Simular desconexi√≥n
            Object.defineProperty(navigator, 'onLine', { get: () => false });
            
            // Intentar una petici√≥n
            fetch('http://localhost:3000/api/productos')
                .then(response => {
                    log('‚ùå La conexi√≥n deber√≠a fallar', 'error');
                    updateResultado('üîå Error de conexi√≥n simulado', 'error');
                })
                .catch(error => {
                    log(`‚úÖ Error de conexi√≥n capturado: ${error.message}`, 'success');
                    updateResultado(`‚úÖ Error de conexi√≥n capturado: ${error.message}`, 'success');
                })
                .finally(() => {
                    // Restaurar conexi√≥n
                    Object.defineProperty(navigator, 'onLine', { get: () => true });
                    updateResultado('üü¢ Conexi√≥n restaurada', 'success');
                });
        }
        
        function testOnline() {
            log('Restaurando conexi√≥n...', 'info');
            updateResultado('üü¢ Conexi√≥n restaurada', 'success');
            
            // Restaurar conexi√≥n
            Object.defineProperty(navigator, 'onLine', { get: () => true });
            updateResultado('üü¢ Conexi√≥n restaurada', 'success');
        }
        
        // Detectar cambios de conexi√≥n reales
        window.addEventListener('online', () => {
            log('üü¢ Conexi√≥n restaurada autom√°ticamente', 'success');
            updateResultado('üü¢ Conexi√≥n restaurada autom√°ticamente', 'success');
        });
        
        window.addEventListener('offline', () => {
            log('üî¥ Conexi√≥n perdida autom√°ticamente', 'error');
            updateResultado('üî¥ Conexi√≥n perdida autom√°ticamente', 'error');
        });
        
        // Detectar errores de fetch no controlados
        window.addEventListener('unhandledrejection', (event) => {
            log(`‚ùå Error no controlado: ${event.reason}`, 'error');
            updateResultado(`‚ùå Error no controlado: ${event.reason}`, 'error');
        });
    </script>
</body>
</html>
